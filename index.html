<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Mobilidade Pro - Central de Itiner√°rios</title>
    <style>
        :root {
            --primary: #4361ee;
            --whatsapp: #25d366;
            --bg: #f4f7fe;
            --card: #ffffff;
            --text: #212529;
            --border: #e2e8f0;
            --muted: #64748b;
            --accent: #4361ee15;
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --bg: #0f172a;
                --card: #1e293b;
                --text: #f8fafc;
                --border: #334155;
                --muted: #94a3b8;
                --accent: #4361ee30;
            }
        }

        body {
            font-family: 'Inter', system-ui, -apple-system, sans-serif;
            background: var(--bg);
            color: var(--text);
            margin: 0; padding: 15px;
            transition: all 0.3s ease;
        }

        .container { max-width: 1100px; margin: 0 auto; }

        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .header h2 { font-size: 1.4rem; margin: 0; }

        /* BUSCA */
        .search-container { position: relative; margin-bottom: 20px; }
        .search-box input {
            width: 100%; padding: 16px; padding-right: 45px;
            border: 1px solid var(--border); border-radius: 14px;
            background: var(--card); color: var(--text); font-size: 16px; outline: none;
            box-sizing: border-box; transition: 0.2s;
        }
        .search-box input:focus { border-color: var(--primary); box-shadow: 0 0 0 3px var(--accent); }

        .btn-clear-search {
            position: absolute; right: 15px; top: 50%; transform: translateY(-50%);
            background: var(--border); color: var(--muted); border: none;
            width: 24px; height: 24px; border-radius: 50%; cursor: pointer;
            display: none; align-items: center; justify-content: center; font-size: 12px;
        }
        .search-box input:not(:placeholder-shown) + .btn-clear-search { display: flex; }

        /* FILTROS */
        .filter-controls { display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; }
        .filter-btn {
            background: var(--card); border: 1px solid var(--border);
            padding: 10px 18px; border-radius: 25px; font-size: 0.85rem;
            cursor: pointer; color: var(--text); white-space: nowrap; transition: 0.2s;
            display: flex; align-items: center; gap: 5px;
        }
        .filter-btn.active { background: var(--primary); color: white; border-color: var(--primary); }

        .dropdown-content {
            display: none; position: absolute; top: 45px; left: 0;
            background: var(--card); min-width: 200px; box-shadow: 0 10px 25px rgba(0,0,0,0.15);
            border-radius: 12px; border: 1px solid var(--border); z-index: 100;
            max-height: 250px; overflow-y: auto; padding: 8px;
        }
        .dropdown-content.show { display: block; animation: fadeIn 0.2s ease; }
        .dropdown-item { padding: 12px 15px; cursor: pointer; border-radius: 8px; font-size: 0.9rem; transition: 0.2s; }
        .dropdown-item:hover { background: var(--accent); color: var(--primary); }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }

        /* TABELA */
        .table-wrapper { background: var(--card); border-radius: 18px; overflow: hidden; box-shadow: 0 10px 30px rgba(0,0,0,0.05); overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; min-width: 950px; }
        th { background: var(--accent); padding: 15px; text-align: left; font-size: 0.7rem; color: var(--muted); text-transform: uppercase; letter-spacing: 0.5px; }
        td { padding: 15px; border-bottom: 1px solid var(--border); font-size: 0.85rem; }

        .col-linha { font-weight: 700; color: var(--primary); }
        .col-turno { font-weight: 600; text-transform: uppercase; font-size: 0.75rem; color: var(--muted); }

        .btn-share {
            background: var(--whatsapp); color: white; border: none;
            padding: 8px 14px; border-radius: 8px; cursor: pointer;
            font-size: 0.75rem; display: flex; align-items: center; gap: 6px; text-decoration: none; transition: 0.2s;
        }
        .btn-share:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(37, 211, 102, 0.3); }

        @media (max-width: 900px) {
            table { min-width: 100%; }
            table thead { display: none; }
            tr { display: block; padding: 15px; border-bottom: 8px solid var(--bg); }
            td { display: flex; justify-content: space-between; align-items: center; padding: 10px 0; border: none; text-align: right; }
            td::before { content: attr(data-label); font-weight: 600; color: var(--muted); font-size: 0.7rem; text-transform: uppercase; text-align: left; }
            td.col-linha { font-size: 1.2rem; color: var(--primary); border-bottom: 1px solid var(--accent); padding-bottom: 10px; margin-bottom: 10px; }
        }

        .skeleton { height: 15px; background: var(--border); border-radius: 10px; position: relative; overflow: hidden; margin-bottom: 10px; }
        .skeleton::after {
            content: ""; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            animation: loading 1.5s infinite;
        }
        @keyframes loading { 0% { transform: translateX(-100%); } 100% { transform: translateX(100%); } }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <h2>üöå Itiner√°rios</h2>
        <div id="relogio" style="font-size: 0.9rem; opacity: 0.7;">00:00:00</div>
    </div>

    <div class="search-container">
        <div class="search-box">
            <input type="text" id="search" placeholder="Busque por bairro, linha ou ponto..." autocomplete="off">
            <button class="btn-clear-search" id="clearSearch">‚úï</button>
        </div>
    </div>

    <div class="filter-controls">
        <button class="filter-btn active" id="btnLimpar" onclick="limparFiltros()">üîÑ Limpar</button>

        <div style="position: relative;">
            <button class="filter-btn" id="btnFiltroBairro" onclick="toggleDropdown('dropBairro')">üìç Bairro ‚ñæ</button>
            <div id="dropBairro" class="dropdown-content"></div>
        </div>

        <div style="position: relative;">
            <button class="filter-btn" id="btnFiltroLinha" onclick="toggleDropdown('dropLinha')">üî¢ Linha ‚ñæ</button>
            <div id="dropLinha" class="dropdown-content"></div>
        </div>
    </div>

    <div class="table-wrapper">
        <table>
            <thead>
            <tr>
                <th>Turno</th>
                <th>Linha</th>
                <th>Tipo</th>
                <th>Bairro</th>
                <th>Ponto de Passagem</th>
                <th>Parada</th>
                <th>A√ß√£o</th>
            </tr>
            </thead>
            <tbody id="tableBody">
            <tr><td colspan="7"><div class="skeleton"></div></td></tr>
            </tbody>
        </table>
    </div>
</div>

<script>
    let pontos = [];
    let filtroAtivo = { bairro: null, linha: null };

    // Rel√≥gio em tempo real
    setInterval(() => {
        document.getElementById('relogio').innerText = new Date().toLocaleTimeString('pt-br');
    }, 1000);

    // Controle de Dropdowns
    function toggleDropdown(id) {
        document.querySelectorAll('.dropdown-content').forEach(d => {
            if (d.id !== id) d.classList.remove('show');
        });
        document.getElementById(id).classList.toggle("show");
    }

    window.onclick = function(event) {
        if (!event.target.closest('.filter-controls')) {
            document.querySelectorAll('.dropdown-content').forEach(d => d.classList.remove('show'));
        }
    }

    // Carregamento do CSV
    async function carregarCSV() {
        try {
            const response = await fetch('pontos.csv');
            const data = await response.text();
            // Suporta separa√ß√£o por v√≠rgula ou ponto e v√≠rgula
            const linhasCSV = data.split(/\r?\n/).filter(l => l.trim() !== "");

            pontos = linhasCSV.slice(1).map(linha => {
                // Tenta separar por v√≠rgula, se n√£o der, tenta ponto e v√≠rgula
                const col = linha.includes(';') ? linha.split(';') : linha.split(',');
                return {
                    turno: col[0]?.trim() || '-',
                    linha: col[1]?.trim() || '-',
                    tipo:  col[2]?.trim() || '-',
                    bairro: col[3]?.trim() || '-',
                    ponto:  col[4]?.trim() || '-',
                    parada: col[5]?.trim() || '-'
                };
            });

            atualizarMenus();
            aplicarFiltros();
        } catch (e) {
            tableBody.innerHTML = "<tr><td colspan='7' style='text-align:center'>Erro ao carregar o arquivo CSV. Verifique o nome e o formato.</td></tr>";
        }
    }

    // Filtros Inteligentes (Linha depende do Bairro)
    function atualizarMenus() {
        const bairrosUnicos = [...new Set(pontos.map(p => p.bairro))].sort();
        document.getElementById('dropBairro').innerHTML = bairrosUnicos.map(b => `
            <div class="dropdown-item" onclick="setFiltro('bairro', '${b}')">${b}</div>
        `).join('');

        let linhasDisponiveis = filtroAtivo.bairro ? pontos.filter(p => p.bairro === filtroAtivo.bairro) : pontos;
        const linhasUnicas = [...new Set(linhasDisponiveis.map(p => p.linha))].sort();

        document.getElementById('dropLinha').innerHTML = linhasUnicas.map(l => `
            <div class="dropdown-item" onclick="setFiltro('linha', '${l}')">${l}</div>
        `).join('');
    }

    function setFiltro(tipo, valor) {
        filtroAtivo[tipo] = valor;
        const btnId = tipo === 'bairro' ? 'btnFiltroBairro' : 'btnFiltroLinha';
        const label = tipo === 'bairro' ? `üìç ${valor}` : `üî¢ ${valor}`;

        document.getElementById(btnId).innerHTML = `${label} ‚ñæ`;
        document.getElementById(btnId).classList.add('active');
        document.getElementById('btnLimpar').classList.remove('active');

        if (tipo === 'bairro') {
            filtroAtivo.linha = null;
            document.getElementById('btnFiltroLinha').innerHTML = `üî¢ Linha ‚ñæ`;
            document.getElementById('btnFiltroLinha').classList.remove('active');
        }

        document.querySelectorAll('.dropdown-content').forEach(d => d.classList.remove('show'));
        atualizarMenus();
        aplicarFiltros();
    }

    function aplicarFiltros() {
        let res = pontos;
        if (filtroAtivo.bairro) res = res.filter(p => p.bairro === filtroAtivo.bairro);
        if (filtroAtivo.linha) res = res.filter(p => p.linha === filtroAtivo.linha);

        const busca = document.getElementById('search').value.toLowerCase();
        if (busca) {
            res = res.filter(p => Object.values(p).some(v => v.toLowerCase().includes(busca)));
        }
        mostrarTabela(res);
    }

    function limparFiltros() {
        filtroAtivo = { bairro: null, linha: null };
        document.getElementById('btnFiltroBairro').innerHTML = `üìç Bairro ‚ñæ`;
        document.getElementById('btnFiltroBairro').classList.remove('active');
        document.getElementById('btnFiltroLinha').innerHTML = `üî¢ Linha ‚ñæ`;
        document.getElementById('btnFiltroLinha').classList.remove('active');
        document.getElementById('btnLimpar').classList.add('active');
        document.getElementById('search').value = "";
        atualizarMenus();
        aplicarFiltros();
    }

    // WHATSAPP DIRETO PARA O N√öMERO (98) 98238-0013
    function compartilhar(p) {
        const numeroWhatsApp = "5598982380013";
        const msg = `üöå *ITINER√ÅRIO MOBILIDADE PRO*%0A%0A` +
            `*Linha:* ${p.linha}%0A` +
            `*Turno:* ${p.turno}%0A` +
            `*Viagem:* ${p.tipo}%0A` +
            `*Bairro:* ${p.bairro}%0A` +
            `*Ponto:* ${p.ponto}%0A` +
            `*Parada:* ${p.parada}`;

        window.open(`https://api.whatsapp.com/send?phone=${numeroWhatsApp}&text=${msg}`, '_blank');
    }

    function mostrarTabela(lista) {
        if (lista.length === 0) {
            tableBody.innerHTML = "<tr><td colspan='7' style='text-align:center; padding: 40px;'>Nenhum resultado encontrado.</td></tr>";
            return;
        }
        tableBody.innerHTML = lista.map(p => `
            <tr>
                <td data-label="Turno" class="col-turno">${p.turno}</td>
                <td data-label="Linha" class="col-linha">${p.linha}</td>
                <td data-label="Tipo">${p.tipo}</td>
                <td data-label="Bairro">${p.bairro}</td>
                <td data-label="Ponto de Passagem">${p.ponto}</td>
                <td data-label="Parada">${p.parada}</td>
                <td data-label="A√ß√£o">
                    <button class="btn-share" onclick='compartilhar(${JSON.stringify(p)})'>üì≤ Avisar</button>
                </td>
            </tr>
        `).join('');
    }

    // Eventos de Busca
    const inputSearch = document.getElementById("search");
    inputSearch.addEventListener("input", aplicarFiltros);
    document.getElementById("clearSearch").addEventListener("click", () => {
        inputSearch.value = "";
        aplicarFiltros();
        inputSearch.focus();
    });

    carregarCSV();
</script>
</body>
</html>
